<!DOCTYPE html>
<html lang="en-us">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>syscp with libnss-mysql</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: darkgray;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/css/main.css">





<link rel="stylesheet" href="/css/custom.css">


 <link rel="stylesheet" href="/css/solarized-dark.css"> 


<link rel="stylesheet" href="/css/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
 


    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>







<script src="/js/jquery-3.3.1.min.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.41" />
        

        
    </head>

    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">syscp with libnss-mysql</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/historical-blog-posts/">Historical Blog</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/kTitan/"><i class="fa fa-github"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="item">

    
    
    

    
    

    <h4><a href="/linux/syscp-with-libnss-mysql/">syscp with libnss-mysql</a></h4>
    <h5>December 31, 2007</h5>
    
    <a href="/tags/gentoo"><kbd class="item-tag">Gentoo</kbd></a>
    
    <a href="/tags/linux"><kbd class="item-tag">Linux</kbd></a>
    
    <a href="/tags/software"><kbd class="item-tag">Software</kbd></a>
    
    <a href="/tags/syscp"><kbd class="item-tag">syscp</kbd></a>
    

</div>


    <br> <div class="text-justify"><p>After installing a new rootserver with syscp, I decided to also install libnss-mysql support on the system. The advantage is, that it is easy to see which file belongs to which user. I hate to only see the uids and gids ðŸ˜‰</p>

<p>Because I use gentoo on the server, I emerged libnss-mysql. If you use an other distribution, you have to install it with your package manager if it is available. I used version 1.5 of it.</p>

<p>Now it was a bit tricky to find the right config for syscp for it. After a long search and many tries now it works good. Here are my configs:</p>

<p></p>

<p>/etc/libnss-mysql-root.cfg:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">&gt; username syscp
&gt; password SYSCPPASSWORD</code></pre></div>

<p>/etc/libnss-mysql.cfg</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">&gt; getpwnam SELECT username,&#39;x&#39;,uid,gid,username,homedir,shell \
&gt; FROM ftp_users \
&gt; WHERE username=&#39;%1$s&#39; \
&gt; LIMIT 1
&gt; getpwuid SELECT username,&#39;x&#39;,uid,gid,username,homedir,shell \
&gt; FROM ftp_users \
&gt; WHERE uid=&#39;%1$u&#39; \
&gt; LIMIT 1
&gt; getpwent SELECT username,&#39;x&#39;,uid,gid,username,homedir,shell \
&gt; FROM ftp_users
&gt; getspnam SELECT username,password,&#39;12345&#39;,&#39;0&#39;,&#39;99999&#39;,&#39;7&#39;,&#34;,&#34;,&#34; \
&gt; FROM ftp_users \
&gt; WHERE username=&#39;%1$s&#39; \
&gt; LIMIT 1
&gt; getspent SELECT username,password,&#39;12345&#39;,&#39;0&#39;,&#39;99999&#39;,&#39;7&#39;,&#34;,&#34;,&#34; \
&gt; FROM ftp_users
&gt; getgrnam SELECT groupname,&#34;,gid \
&gt; FROM ftp_groups \
&gt; WHERE groupname=&#39;%1$s&#39; \
&gt; LIMIT 1
&gt; getgrgid SELECT groupname,&#34;,gid \
&gt; FROM ftp_groups \
&gt; WHERE gid=&#39;%1$u&#39; \
&gt; LIMIT 1
&gt; getgrent SELECT groupname,&#34;,gid \
&gt; FROM ftp_groups
&gt; memsbygid SELECT username \
&gt; FROM ftp_users \
&gt; WHERE gid=&#39;%1$u&#39;
&gt; gidsbymem SELECT gid \
&gt; FROM ftp_users \
&gt; WHERE username=&#39;%1$s&#39;
&gt;
&gt; host localhost
&gt; database syscp
&gt; username syscp
&gt; password SYSCPPASSWORD
&gt; #socket /var/lib/mysql/mysql.sock
&gt; #port 3306
&gt; timeout 3
&gt; compress 0</code></pre></div>

<p>Now it would be good to also use this ;). So you have to change /etc/nsswitch.conf like this:</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">&gt; passwd: compat mysql
&gt; shadow: compat mysql
&gt; group: compat mysql</code></pre></div></p>

<p>If you use the nscd don&rsquo;t forget to restart it!</p>

<p>And that was it already ðŸ˜‰</p></div>

    
    

    

    

</main>

        <footer>

            <p class="copyright text-muted"></p>

        </footer>
       
    </body>

</html>

